\documentclass[a4paper, 12pt]{report}
%================================================================
\usepackage{color,amsmath,amsfonts,amssymb,epsfig,hyperref}
\usepackage{graphicx}
\usepackage{dsfont}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{pdfpages}
%====================================
 \textheight 24cm
% \doublespace
  \oddsidemargin -0.5cm
  \evensidemargin +1.5cm
  \textwidth 17cm
 \topmargin -2cm
%============================================
% Figures
%============================================
\newcommand{\figsstit}[2]{
\begin{figure}[hbtp]
\centerline{
    \hbox{ \includegraphics[scale=#2]{#1} }
}
\end{figure}}
%============================================
\newcommand{\figscale}[4]{
\begin{figure}[hbtp]
\centerline{
    \hbox{ \includegraphics[scale=#4]{#1} }
}
\begin{center}
\parbox{14 cm}
{
    \caption{\protect\small\it  {#2}}
    \label {#3}
}
\end{center}

\end{figure}}

%==================================================
\newcommand\algo[1]%
{
    \begin{center} %
    \begin{tabular} {||p{10 cm}l ||}%
    \hline
               #1 &  \\
    \hline
    \end{tabular}
    \vspace{12pt}
    \end{center}
}


%==============================================
\newcommand{\prob}[1]{\mathds{P}\left( #1 \right)}
\newcommand{\esp}[1]{\mathds{E}\left[ #1 \right]}
\newcommand{\var}[1]{\mathrm{var}\left( #1 \right)}
\newcommand{\cov}[1]{\mathrm{cov}\left( #1 \right)}
\newcommand{\diag}[1]{\mathrm{diag}\left( #1 \right)}
\newcommand{\trace}[1]{\mathrm{trace}\left( #1 \right)}
\newcommand{\card}[1]{\left| #1 \right|}
\newcommand{\myemph}[1]{\emph{\color{red}#1}}

%%============================================================================
\def\thesection{\arabic{section}}
%\def\thesubsection{\arabic{section}.\arabic{subsection}}
%\def\thesubsubsection{\arabic{section}.\arabic{subsection}.\arabic{subsubsection}}
%\def\thefigure{\arabic{figure}}
%\def\theequation{\arabic{equation}}
%\def\theexercice{\arabic{exercice}}
%\def\theexample{\arabic{example}}
%\def\theproof{\arabic{proof}}

%===============================================
\newtheorem{property}{Properties}
\newtheorem{remark}{Remark}
\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}
\newtheorem{example}{Example}
\newtheorem{lemme}{Lemme - \thelemme}
\newtheorem{proof}{Proof - \theproof}
\newenvironment{TAB}{\begin{table}[[hbt] \center \leavevmode}{\end{table}}
%%============================================================================
%\renewcommand\arraystretch{1.6}

\def\ua{\underline a}
\def\ub{\underline b}
\def\uB{\underline B}
\def\uH{\underline H}
\def\ur{\underline r}
\def\us{\underline s}
\def\ux{\underline x}
\def\uX{\underline X}
\def\uZ{\underline Z}
\def\utheta{\underline \theta}



\def\tn{\mathrm{TN}}
\def\fn{\mathrm{FN}}
\def\tp{\mathrm{TP}}
\def\fp{\mathrm{FP}}
\def\tpn{\mathrm{tPN}}
\def\tnn{\mathrm{tNN}}
\def\tdn{\mathrm{tDN}}

\def\precision{\mathrm{\color{red}Precision}}
\def\recall{\mathrm{\color{red}Recall}}
\def\fscore{{\color{red}F\mathrm{-score}}}
\def\far{\mathrm{FAR}}
\def\mdr{\mathrm{MDR}}
\def\vdr{\mathrm{VDR}}
\def\ci{\mathrm{CI}}
\def\pfa{P_{\mathrm{FA}}}
\def\pd{P_{\mathrm{D}}}
\def\loc{\mathrm{LOC}}

\def\SNR{\mathrm{SNR}}
\def\crb{\mathrm{CRB}}
\def\fim{\mathrm{FIM}}

\def\auc{\mathrm{AUC}}
\def\aec{\mathrm{aec}}



\def\void{{\small void}}
\def\nomeaning{{\small meaningless}}
\def\unknown{{\small unknown}}
\def\MSC{\mathrm{MSC}}
\def\hMSC{\widehat{\MSC}}%{\MSC}} 
\def\ellk{{k}}
\def\SOI{common signal part }
\def\absGamma{\Phi}

%============== colors ========================
\definecolor{enstrouge}{RGB}{212,65,84}
\definecolor{lightorange}{RGB}{235,226,52}
\definecolor{greennoise}{RGB}{243,42,255}
\definecolor{lightred}{RGB}{255,181,183}
\definecolor{light-grey}{rgb}{0.95,0.95,0.95}
\definecolor{peach}{rgb}{0.98,0.49,0.25}
\definecolor{burntorange}{rgb}{0.79,0.37,0}
\definecolor{light-yellow}{rgb}{1,1,0.92}

\definecolor{light-green}{RGB}{231,255,145}
\definecolor{enstorange}{RGB}{255,214,10}
\definecolor{enstrouge}{RGB}{212,65,84}
\definecolor{grey}{RGB}{204,204,204}
\definecolor{blue}{RGB}{0,0,255}
\definecolor{almost-black}{RGB}{100,100,100}
\definecolor{violet}{rgb}{0.4,0,0.4}
\definecolor{cyan}{RGB}{0,255,255}
\definecolor{magenta}{RGB}{243,42,255}

\def\degree{^{\circ}}
\def\simiid{\stackrel{\mathrm{i.i.d.}}{\sim}}
\def\simind{\stackrel{\mathrm{ind.}}{\sim}}

 
%%%============================================================================
%%\def\thesection{\arabic{section}}
%%\def\thefigure{\arabic{figure}}
%%\def\theequation{\arabic{equation}}
%%\def\theexercice{\arabic{exercice}}
%%\def\theequation{\arabic{exercice}.\arabic{equation}}
%%%============================================================================
%%\newcounter{auxiliaire}
%%%%%%%%% comment
%%\setcounter{auxiliaire}{\theenumi}
%%\end{enumerate}
%% TEXTE
%%\begin{enumerate}
%%\setcounter{enumi}{\theauxiliaire}
%%%============================================================================

 \bibliographystyle{plain} 

\begin{document}
 \sloppy
%=======================================================
%=======================================================
\section{Introduction}
A 3D seismic device measures the three components of an acceleration vector in three specific directions attached to the device. These three directions form a trihedron almost orthogonal but not exactly. We denote $v_{u,1}$,  $v_{u,2}$,  $v_{u,3}$ the unitary vectors of these 3 directions of the seismic device under test (SUT), and  $v_{r,1}$,  $v_{r,2}$,  $v_{r,3}$ those of the reference system (SREF). It follows that the 3 signals on SUT write:
\begin{eqnarray*}
\left\{
\begin{array}{rcl}
x_{u,1}(t)&=&h_{u,1}(t)\star (v_{u,1,1}g_{x}(t)+v_{u,1,2}g_{y}(t)+v_{u,1,3}g_{z}(t))
\\
x_{u,2}(t)&=&h_{u,2}(t)\star (v_{u,2,1}g_{x}(t)+v_{u,2,2}g_{y}(t)+v_{u,2,3}g_{z}(t))
\\
x_{u,3}(t)&=&h_{u,3}(t)\star (v_{u,3,1}g_{x}(t)+v_{u,3,2}g_{y}(t)+v_{u,3,3}g_{z}(t))
\end{array}
\right.
\end{eqnarray*}
and similar equations for the SREF. In frequency domain we get:
\begin{eqnarray*}
\left\{
\begin{array}{rcl}
X_{u,1}(f)&=&H_{u,1}(f) (v_{u,1,1}G_{x}(f)+v_{u,1,2}G_{y}(f)+v_{u,1,3}G_{z}(f))
\\
X_{u,2}(f)&=&H_{u,2}(f) (v_{u,2,1}G_{x}(f)+v_{u,2,2}G_{y}(f)+v_{u,2,3}G_{z}(f))
\\
X_{u,3}(f)&=&H_{u,3}(f) (v_{u,3,1}G_{x}(f)+v_{u,3,2}G_{y}(f)+v_{u,3,3}G_{z}(f))
\end{array}
\right.
\end{eqnarray*}
More concisely we write
\begin{eqnarray*}
X_{u}(f)&=&H_{u}(f)V_{u}G(f)
\end{eqnarray*}
where 
\begin{eqnarray*}
H_{u}(f)&=&
\begin{bmatrix}
H_{u,1}(f)&0&0
\\
0&H_{u,2}(f)&0
\\
0&0&H_{u,3}(f)
\end{bmatrix}
\end{eqnarray*}
and where $V_{u}$ is the square matrix whose entries are $v_{u,k}$. Because the columns of $V_{u}$ are normalized, $V_{u}$ depends on 6 free parameters. A possible parametrization in an arbitrary orthonormal coordinate system is:
\begin{eqnarray}
\label{eq:parametricformofV}
V(\phi_{u})&=&
\begin{bmatrix}
\cos(a_{u,1})\cos(e_{u,1})&\sin(a_{u,1})\cos(e_{u,1})&\sin(e_{u,1})
\\
\cos(a_{u,2})\cos(e_{u,2})&\sin(a_{u,2})\cos(e_{u,2})&\sin(e_{u,2})
\\
\cos(a_{u,3})\cos(e_{u,3})&\sin(a_{u,3})\cos(e_{u,3})&\sin(e_{u,3})
\end{bmatrix}
\end{eqnarray}
where $\phi_{u}=(a_{u,1},a_{u,2},a_{u,3},e_{u,1},e_{u,2},e_{u,3})\in\Phi= (0,2\pi)^{\otimes 3}\times (0,\pi)^{\otimes 3}$

In our protocol, the  reference system (SREF) is a portable seismic device whose the trihedron  is perfectly known. 
Therefore we have in the absence of noise:
\begin{eqnarray}
\label{eq:signalmodel}
\left\{
\begin{array}{rcl}
X_{u}(f)&=&H_{u}(f)V(\phi_{u})G(f)
\\
X_{r}(f)&=&H_{r}(f)V(\phi_{r})G(f)
\end{array}
\right.
\end{eqnarray}

The objective is to estimate $\phi_{u}$, knowing $H_{r}(f)$,  $\phi_{r}$, $H_{u}(f)$ and observing $X_{u}(f)$ and $X_{r}(f)$.
More specifically we can estimate the product $H_{u}(f)V_{u}$, but in the absence of a priori knowledge it is impossible to solve separately $H_{u}(f)$ and $V_{u}$.


%=====================================
%=====================================
\section{Resolution w.r.t. $V_{u}$}
%=====================================
In this section we assume that we know the response $H_{u}(f)$ of the SUT. Then solving the second equation of \eqref{eq:signalmodel} w.r.t. $G(f)$, we get:
\begin{eqnarray*}
X_{u}(f)&=&H_{u}(f)V(\phi_{u})V ^{-1}(\phi_{r})H_{r}^{-1}(f)X_{r}(f)
\end{eqnarray*}
It is worth to notice that integrating w.r.t. $f$ leads
\begin{eqnarray*}
\sum H_{u}^{-1}(f)X_{u}(f)X_{u}^{H}(f)&=&V(\phi_{u})V^{-1}(\phi_{r})\sum H_{r}^{-1}(f)X_{r}(f)X_{u}^{H}(f)
\end{eqnarray*}

We let the 3 dimensional matrix:
\begin{eqnarray*}
S_{uu}&=&\sum_{f} H_{u}^{-1}(f)X_{u}(f)X_{u}^{H}(f)
\end{eqnarray*}
the 3 dimensional matrix
\begin{eqnarray*}
S_{ru}&=&\sum_{f} H_{r}^{-1}(f)X_{r}(f)X_{u}^{H}(f)
\end{eqnarray*}
and the cost function
\begin{eqnarray*}
J(\phi) &=&  \|S_{uu} - V(\phi)V^{-1}(\phi_{r})S_{ru}\|_{F}^{2}
\end{eqnarray*}
where $\|M\|^{2}_{F}$ is the Froebinius norm of $M$, i.e. $\trace{MM^{H}}$. The least square approach leads to:
\begin{eqnarray*}
\hat \phi &=& \arg\min_{\phi\in\Phi} J(\phi)
\end{eqnarray*}
which can be solved numerically.
Then, carrying this estimate in \eqref{eq:parametricformofV} provides an estimate of $V_{u}$. Unfortunately searching for the minimum in a 6 dimensional set could be very cumbersome. However we can expect that the 3 measurement axes  are very close for the 2 sensors, particularly for the vertical.

\subsubsection{Sub-optimal approach}
The algorithm works in two steps
\begin{enumerate}
\item
at first we only consider the vertical component of the SUT and we estimate the unitary vector carrying the so called vertical component of the SUT. This optimization consists of 2 angles. More specifically we let
\begin{eqnarray*}
S_{uu,3}&=&\sum_{f} H_{u,3}^{-1}(f)|X_{u,3}(f)|^{2}
\end{eqnarray*}

\begin{eqnarray*}
S_{ru,3}&=&\sum_{f} H_{r}^{-1}(f)X_{r}(f)X_{u,3}^{*}(f)
\end{eqnarray*}


\begin{eqnarray*}
v(a,e) &=& \begin{bmatrix}
\cos(a)\cos(e)& \sin(a)\cos(e)& \sin(e)
\end{bmatrix}
\end{eqnarray*}
and
\begin{eqnarray*}
J(a_{3},e_{3}) &=&  \left|S_{uu,3} - v(a_{3},e_{3})V^{-1}(\phi_{r})S_{ru,3} \right|^{2}
\end{eqnarray*}

\item

At the second step we globally estime the orientation of the two other components. More specifically we let
\begin{eqnarray*}
S_{uu,12}&=&\sum_{f} H_{u,1:2}^{-1}(f) X_{u,1:2}(f)X^{H}_{u,1:2}(f)
\end{eqnarray*}

\begin{eqnarray*}
S_{ru,12}&=&\sum_{f} H_{r}^{-1}(f)X_{r}(f)X_{u,1:2}^{H}(f)
\end{eqnarray*}


\begin{eqnarray*}
v(a_{1},e_{1},a_{2},e_{2}) &=& \begin{bmatrix}
\cos(a_{1})\cos(e_{1})& \sin(a_{1})\cos(e_{1})& \sin(e_{1})
\\
\cos(a_{2})\cos(e_{2})& \sin(a_{2})\cos(e_{2})& \sin(e_{2})
\end{bmatrix}
\end{eqnarray*}
and
\begin{eqnarray*}
J(a_{1},e_{1},a_{2},e_{2})  &=&  \left|S_{uu,12} - v(a_{1},e_{1},a_{2},e_{2}) V^{-1}(\phi_{r})S_{ru,12} \right|^{2}
\end{eqnarray*}



\end{enumerate}



%=====================================
%=====================================
\section{General resolution}
%=====================================
In this section we assume that the response $H_{u}(f)$ of the SUT depends on a $P$-dimensional parameter $a$.  Then:

\begin{eqnarray*}
[\hat \phi, \hat a] &=& \arg\min_{\phi, a} \|S_{uu}(a) - V_{u}(\phi)V_{r}^{-1}S_{ru}\|^{2}
\end{eqnarray*}
where 
\begin{eqnarray*}
S_{uu}(a) &=&
\sum H_{u}^{-1}(f;a)X_{u}(f)X_{u}^{H}(f)
\end{eqnarray*}
which can be solved numerically with reasonable computational effort (maybe!)

\end{document}



